{"version":3,"file":"index.modern.js","sources":["../src/context/addContext.tsx","../src/api.ts","../src/components/Add.tsx","../src/context/AddReducer.ts","../src/context/AddProvider.tsx"],"sourcesContent":["import { createContext } from 'react'\nimport { Advertiser } from '../types'\n\ninterface ContextType {\n  registerAdd: (id: string) => void\n  addConversion: (id: string) => void\n  advertisers: Array<Advertiser>\n}\n\nconst initialContext: ContextType = {\n  advertisers: [],\n  registerAdd: () => {},\n  addConversion: () => {}\n}\n\nconst AppContext = createContext(initialContext)\n\nexport default AppContext\n","import { Advertiser, AddItem } from './types'\n\nconst advertisers = [\n  {\n    advertiser: 'add1'\n  },\n  {\n    advertiser: 'add2'\n  }\n]\n\nconst adds = {\n  add1: {\n    uid: 'uid-1',\n    img:\n      'https://firebasestorage.googleapis.com/v0/b/renteasy-3ce44.appspot.com/o/1000-1.jpg?alt=media&token=9350dae5-990c-43a1-99ee-594d74533b39',\n    url:\n      'https://www.amazon.com/Rupesh-Padhye-Rent-Easy/dp/B01M5IDOYG/ref=sr_1_1?s=mobile-apps&ie=UTF8&qid=1530965429&sr=1-1&keywords=rent+easy'\n  },\n  add2: {\n    uid: 'uid-1',\n    img:\n      'https://firebasestorage.googleapis.com/v0/b/renteasy-3ce44.appspot.com/o/1000-3.jpg?alt=media&token=0a737b2b-98a8-44da-91bc-41dd21d2b906',\n    url:\n      'https://www.amazon.com/Rupesh-Padhye-Rent-Easy/dp/B01M5IDOYG/ref=sr_1_1?s=mobile-apps&ie=UTF8&qid=1530965429&sr=1-1&keywords=rent+easy'\n  },\n  add3: {\n    uid: 'uid-1',\n    img:\n      'https://firebasestorage.googleapis.com/v0/b/renteasy-3ce44.appspot.com/o/1000-3.jpg?alt=media&token=0a737b2b-98a8-44da-91bc-41dd21d2b906',\n    url:\n      'https://www.amazon.com/Rupesh-Padhye-Rent-Easy/dp/B01M5IDOYG/ref=sr_1_1?s=mobile-apps&ie=UTF8&qid=1530965429&sr=1-1&keywords=rent+easy'\n  }\n}\n\nexport const getAdvertisers = (\n  count: number,\n  exclude: any\n): Promise<Advertiser[]> => {\n  console.log(count, exclude)\n  return Promise.resolve(advertisers)\n}\n\nexport const getAdvertise = (\n  advertiserInfo: Advertiser,\n  size: string\n): Promise<AddItem> => {\n  console.log(size)\n  return Promise.resolve(adds[advertiserInfo.advertiser])\n}\n\nexport const recordConversions = (uid: string): Promise<void> => {\n  console.log(uid)\n  return Promise.resolve()\n}\n","import React, { useState, useContext, useEffect } from 'react'\nimport AppContext from '../context/addContext'\nimport styles from './styles.module.css'\nimport { AddItem, Advertiser } from '../types'\nimport { getAdvertise } from '../api'\n\ntype AddSize = 'banner' | 'square' | 'learderboard'\n\ninterface AddProps {\n  size: AddSize\n}\nconst ADD_DIMENSION = {\n  banner: {\n    width: 468,\n    height: 60\n  }\n}\n\nconst Add: React.FC<AddProps> = (props: AddProps) => {\n  const { registerAdd, advertisers, addConversion } = useContext(AppContext)\n  const [key, setKey] = useState<string>()\n  const [imageLoaded, setImageLoaded] = useState<boolean>(false)\n  const [addInfo, setAddInfo] = useState<AddItem>()\n  const { size } = props\n  const dimension = ADD_DIMENSION[size]\n\n  const onAddClicked = () => {\n    addInfo && addConversion(addInfo.uid)\n  }\n\n  const fetchAdvertise = async (advertiser: Advertiser) => {\n    try {\n      const response: AddItem = await getAdvertise(advertiser, size)\n      console.log(response)\n      setAddInfo(response)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  useEffect(() => {\n    const key = `${new Date().getTime()}`\n    registerAdd(key)\n    setKey(key)\n  }, [])\n\n  useEffect(() => {\n    const advertiser = advertisers.find((a) => a.addKey === key)\n    if (advertiser && !addInfo) {\n      fetchAdvertise(advertiser)\n    }\n  }, [advertisers])\n\n  return (\n    <a\n      className={styles.add}\n      style={{\n        width: dimension.width,\n        height: dimension.height\n      }}\n      key={key}\n      href={addInfo && addInfo.url}\n      target='_blank'\n      rel='noreferrer'\n      onClick={onAddClicked}\n    >\n      {!imageLoaded ? (\n        <img\n          src={`https://via.placeholder.com/${dimension.width}x${dimension.height}.png?text=AD`}\n        />\n      ) : null}\n      {addInfo && (\n        <img\n          onLoad={() => setImageLoaded(true)}\n          className={styles.add_img}\n          src={addInfo.img}\n          alt={addInfo.title}\n        />\n      )}\n    </a>\n  )\n}\n\nexport default Add\n","export default (state: any, action: any) => {\n  const { type, payload } = action\n\n  switch (type) {\n    case 'GET_ADVERTISER_REQUEST':\n      return {\n        ...state,\n        addSlots: [...state.addSlots, payload]\n      }\n    case 'SET_ADVERTISERS':\n      return {\n        ...state,\n        advertisers: [...state.advertisers, ...action.payload],\n        addSlots: []\n      }\n    default:\n      return state\n  }\n}\n","import React, { useEffect, useReducer } from 'react'\nimport AppReducer from './AddReducer'\nimport AppContext from './addContext'\nimport { getAdvertisers, recordConversions } from '../api'\nimport { Advertiser } from '../types'\n\ntype addProviderProps = {\n  clientId: string\n}\n\nconst initialState = {\n  advertisers: [],\n  addSlots: []\n}\nconst AddProvider: React.FC<addProviderProps> = ({ clientId, children }) => {\n  const [state, dispatch] = useReducer(AppReducer, initialState)\n  const { advertisers, addSlots } = state\n  const registerAdd = (key: string) => {\n    dispatch({\n      type: 'GET_ADVERTISER_REQUEST',\n      payload: key\n    })\n  }\n\n  const addConversion = async (uid: string) => {\n    try {\n      await recordConversions(uid)\n    } catch (err) {\n      console.log(err)\n    }\n  }\n  const fetchAdvisers = async (addSlots: string[]) => {\n    try {\n      const availableAdvertisers: Advertiser[] = await getAdvertisers(\n        addSlots.length,\n        advertisers.map((a: Advertiser) => a.advertiser)\n      )\n\n      const advertisersMapToAdd = availableAdvertisers.map((a, index) => {\n        return {\n          ...a,\n          addKey: addSlots[index]\n        }\n      })\n      dispatch({\n        type: 'SET_ADVERTISERS',\n        payload: advertisersMapToAdd\n      })\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  useEffect(() => {\n    if (!clientId) {\n      console.error('clientId is required.')\n    }\n    if (clientId && addSlots.length > 0) {\n      fetchAdvisers(addSlots)\n    }\n  }, [addSlots])\n\n  return (\n    <div>\n      <AppContext.Provider\n        value={{\n          advertisers: advertisers,\n          registerAdd: registerAdd,\n          addConversion: addConversion\n        }}\n      >\n        {children}\n      </AppContext.Provider>\n    </div>\n  )\n}\nexport default AddProvider\n"],"names":["initialContext","advertisers","registerAdd","addConversion","AppContext","createContext","advertiser","adds","add1","uid","img","url","add2","add3","getAdvertisers","count","exclude","console","log","Promise","resolve","getAdvertise","advertiserInfo","size","recordConversions","ADD_DIMENSION","banner","width","height","Add","props","useContext","key","setKey","useState","imageLoaded","setImageLoaded","addInfo","setAddInfo","dimension","onAddClicked","fetchAdvertise","response","e","error","useEffect","Date","getTime","find","a","addKey","React","className","styles","add","style","href","target","rel","onClick","src","onLoad","add_img","alt","title","state","action","type","payload","addSlots","initialState","AddProvider","clientId","children","dispatch","useReducer","AppReducer","err","fetchAdvisers","availableAdvertisers","length","map","advertisersMapToAdd","index","Provider","value"],"mappings":"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"}