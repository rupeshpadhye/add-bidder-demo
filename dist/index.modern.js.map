{"version":3,"file":"index.modern.js","sources":["../src/context/addContext.tsx","../src/api.ts","../src/components/Add.tsx","../src/context/AddReducer.ts","../src/context/AddProvider.tsx"],"sourcesContent":["import { createContext } from 'react'\nimport { AdvertiserAddMapping } from '../types'\n\ninterface ContextType {\n  registerAdd: (id: string) => void\n  addConversion: (id: string) => void\n  advertisers: Array<AdvertiserAddMapping>\n}\n\nconst initialContext: ContextType = {\n  advertisers: [],\n  registerAdd: () => {},\n  addConversion: () => {}\n}\n\nconst AppContext = createContext(initialContext)\n\nexport default AppContext\n","import {AddItem } from './types'\n\n\nlet API_URL='';\nexport const getAdvertisers =  async (\n  count: number,\n  exclude: any,\n  clientId: string\n): Promise<string []> => {\n  console.log('exclude 2434',exclude)\n\n  const response = await fetch(`${API_URL}/advertisers?count=${count}&clientId=${clientId}`)\n  return response.json()\n}\nexport const getAdvertise = async (\n  advertiser: string,\n  size: string\n): Promise<AddItem> => {\n  const response = await fetch(`${API_URL}/advertisers/${advertiser}/advertise?size=${size}&random=true`)\n  return response.json()\n}\n\nexport const recordConversions = async (uid: string): Promise<boolean> => {\n  const response = await fetch(`${API_URL}/advertise/${uid}/conversion`,{\n    method: 'POST'\n  })\n  return response.ok;\n}\n","import React, { useState, useContext, useEffect } from 'react'\nimport AppContext from '../context/addContext'\nimport styles from './styles.module.css'\nimport { AddItem, AdvertiserAddMapping } from '../types'\nimport { getAdvertise } from '../api'\n\ntype AddSize = 'banner' | 'square' | 'learderboard'\n\ninterface AddProps {\n  size: AddSize\n}\nconst ADD_DIMENSION = {\n  banner: {\n    width: 468,\n    height: 60\n  }\n}\n\nconst Add: React.FC<AddProps> = (props: AddProps) => {\n  const { registerAdd, advertisers, addConversion } = useContext(AppContext)\n  const [key, setKey] = useState<string>()\n  const [imageLoaded, setImageLoaded] = useState<boolean>(false)\n  const [addInfo, setAddInfo] = useState<AddItem>()\n  const { size } = props\n  const dimension = ADD_DIMENSION[size]\n\n  const onAddClicked = () => {\n    addInfo && addConversion(addInfo.uid)\n  }\n\n  const fetchAdvertise = async (advertiserAddMapping: AdvertiserAddMapping) => {\n    try {\n      const { advertiser } = advertiserAddMapping\n      const response: AddItem = await getAdvertise(advertiser, size)\n      setAddInfo(response)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  useEffect(() => {\n    const key = `${Math.floor(Math.random() * 1000000)}`\n    registerAdd(key)\n    setKey(key)\n  }, [])\n\n  useEffect(() => {\n    const advertiser = advertisers.find((a) => a.addKey === key)\n    if (advertiser && !addInfo) {\n      fetchAdvertise(advertiser)\n    }\n  }, [advertisers])\n\n  return (\n    <a\n      className={styles.add}\n      style={{\n        width: dimension.width,\n        height: dimension.height,\n        display: 'inline-block'\n      }}\n      key={key}\n      href={addInfo && addInfo.url}\n      target='_blank'\n      rel='noreferrer'\n      onClick={onAddClicked}\n    >\n      {imageLoaded && <span className={styles.add_label}>Ad</span>}\n      {!imageLoaded ? (\n        <img\n         decoding=\"async\"\n          src={`https://via.placeholder.com/${dimension.width}x${dimension.height}.png?text=AD`}\n        />\n      ) : null}\n      {addInfo && (\n        <img\n          decoding=\"async\"\n          onLoad={() => setImageLoaded(true)}\n          className={styles.add_img}\n          src={addInfo.img}\n          alt={addInfo.title}\n          style={{ visibility: imageLoaded ? 'visible' : 'hidden' }}\n        />\n      )}\n    </a>\n  )\n}\n\nexport default Add\n","export default (state: any, action: any) => {\n  const { type, payload } = action\n\n  switch (type) {\n    case 'GET_ADVERTISER_REQUEST':\n      return {\n        ...state,\n        addSlots: [...state.addSlots, payload]\n      }\n    case 'SET_ADVERTISERS':\n      return {\n        ...state,\n        advertisers: [...state.advertisers, ...action.payload],\n        addSlots: []\n      }\n    default:\n      return state\n  }\n}\n","import React, { useEffect, useReducer } from 'react'\nimport AppReducer from './AddReducer'\nimport AppContext from './addContext'\nimport { getAdvertisers, recordConversions } from '../api'\nimport { AdvertiserAddMapping } from '../types'\n\ntype addProviderProps = {\n  clientId: string\n}\n\nconst initialState = {\n  advertisers: [],\n  addSlots: []\n}\nconst AddProvider: React.FC<addProviderProps> = ({ clientId, children }) => {\n  const [state, dispatch] = useReducer(AppReducer, initialState)\n  const { advertisers, addSlots } = state\n  const registerAdd = (key: string) => {\n    dispatch({\n      type: 'GET_ADVERTISER_REQUEST',\n      payload: key\n    })\n  }\n\n  const addConversion = async (uid: string) => {\n    try {\n      await recordConversions(uid)\n    } catch (err) {\n      console.log(err)\n    }\n  }\n  const fetchAdvisers = async (addSlots: string[]) => {\n    try {\n      const availableAdvertisers: string [] = await getAdvertisers(\n        addSlots.length,\n        advertisers,\n        clientId\n      )\n      const advertisersMapToAdd : AdvertiserAddMapping [] = \n      availableAdvertisers.map((a, index) => {\n        return {\n          advertiser: a,\n          addKey: addSlots[index]\n        }\n      })\n      console.log(advertisersMapToAdd)\n      dispatch({\n        type: 'SET_ADVERTISERS',\n        payload: advertisersMapToAdd\n      })\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  useEffect(() => {\n    if (!clientId) {\n      console.error('clientId is required.')\n    }\n    if (clientId && addSlots.length > 0) {\n      fetchAdvisers(addSlots)\n    }\n  }, [addSlots])\n  return (\n    <div>\n      <AppContext.Provider\n        value={{\n          advertisers: advertisers,\n          registerAdd: registerAdd,\n          addConversion: addConversion\n        }}\n      >\n        {children}\n      </AppContext.Provider>\n    </div>\n  )\n}\nexport default AddProvider\n"],"names":["initialContext","advertisers","registerAdd","addConversion","AppContext","createContext","getAdvertisers","count","exclude","clientId","console","log","response","fetch","json","getAdvertise","advertiser","size","recordConversions","uid","method","ok","ADD_DIMENSION","banner","width","height","Add","props","useContext","key","setKey","useState","imageLoaded","setImageLoaded","addInfo","setAddInfo","dimension","onAddClicked","fetchAdvertise","advertiserAddMapping","e","error","useEffect","Math","floor","random","find","a","addKey","React","className","styles","add","style","display","href","url","target","rel","onClick","add_label","decoding","src","onLoad","add_img","img","alt","title","visibility","state","action","type","payload","addSlots","initialState","AddProvider","children","dispatch","useReducer","AppReducer","err","fetchAdvisers","availableAdvertisers","length","advertisersMapToAdd","map","index","Provider","value"],"mappings":"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"}