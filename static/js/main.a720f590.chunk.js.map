{"version":3,"sources":["../../src/context/addContext.tsx","../../src/api.ts","../../src/components/Add.tsx","../../src/context/AddReducer.ts","../../src/context/AddProvider.tsx","Content.js","App.js","index.js"],"names":["AppContext","createContext","advertisers","registerAdd","addConversion","getAdvertisers","a","console","fetch","count","response","getAdvertise","advertiser","recordConversions","method","body","JSON","clientId","ADD_DIMENSION","banner","width","height","Add","props","useContext","useState","size","dimension","fetchAdvertise","setAddInfo","useEffect","key","Math","setKey","className","styles","style","display","id","href","addInfo","url","target","rel","onClick","imageLoaded","decoding","src","onLoad","setImageLoaded","img","alt","title","visibility","state","payload","addSlots","action","initialState","AddProvider","children","useReducer","uid","fetchAdvisers","availableAdvertisers","advertisersMapToAdd","addKey","index","dispatch","type","React","value","Content","App","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.a720f590.chunk.js","sourcesContent":["import { createContext } from 'react'\nimport { AdvertiserAddMapping } from '../types'\n\ninterface ContextType {\n  registerAdd: (id: string) => void\n  addConversion: (id: string) => void\n  advertisers: Array<AdvertiserAddMapping>\n}\n\nconst initialContext: ContextType = {\n  advertisers: [],\n  registerAdd: () => {},\n  addConversion: () => {}\n}\n\nconst AppContext = createContext(initialContext)\n\nexport default AppContext\n","import {AddItem } from './types'\n\n\nlet API_URL='';\nexport const getAdvertisers =  async (\n  count: number,\n  exclude: any,\n  clientId: string\n): Promise<string []> => {\n  console.log('exclude',exclude)\n  const response = await fetch(`${API_URL}/advertisers?count=${count}&clientId=${clientId}`)\n  return response.json()\n}\nexport const getAdvertise = async (\n  advertiser: string,\n  size: string\n): Promise<AddItem> => {\n  const response = await fetch(`${API_URL}/advertisers/${advertiser}/advertise?size=${size}&random=true`)\n  return response.json()\n}\n\nexport const recordConversions = async (uid: string, clientId: string): Promise<boolean> => {\n  const response = await fetch(`${API_URL}/advertise/${uid}/conversion`,{\n    method: 'POST',\n    body: JSON.stringify({clientId})\n  })\n  return response.ok;\n}\n","import React, { useState, useContext, useEffect } from 'react'\nimport AppContext from '../context/addContext'\nimport styles from './styles.module.css'\nimport { AddItem, AdvertiserAddMapping } from '../types'\nimport { getAdvertise } from '../api'\n\ntype AddSize = 'banner' | 'square' | 'learderboard'\n\ninterface AddProps {\n  size: AddSize,\n  addKey?: string\n}\nconst ADD_DIMENSION = {\n  banner: {\n    width: 468,\n    height: 60\n  }\n}\n\nconst Add: React.FC<AddProps> = (props: AddProps) => {\n  const { registerAdd, advertisers, addConversion } = useContext(AppContext)\n  const [key, setKey] = useState<string>()\n  const [imageLoaded, setImageLoaded] = useState<boolean>(false)\n  const [addInfo, setAddInfo] = useState<AddItem>()\n  const { size } = props\n  const dimension = ADD_DIMENSION[size]\n\n  const onAddClicked = () => {\n    addInfo && addConversion(addInfo.uid)\n  }\n\n  const fetchAdvertise = async (advertiserAddMapping: AdvertiserAddMapping) => {\n    try {\n      const { advertiser } = advertiserAddMapping\n      const response: AddItem = await getAdvertise(advertiser, size)\n      setAddInfo(response)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  useEffect(() => {\n    const key = props.addKey || `${Math.floor(Math.random() * 1000000)}`\n    registerAdd(key)\n    setKey(key)\n  }, [])\n\n  useEffect(() => {\n    const advertiser = advertisers.find((a) => a.addKey === key)\n    if (advertiser && !addInfo) {\n      fetchAdvertise(advertiser)\n    }\n  }, [advertisers, key])\n\n  return (\n    <a\n      className={styles.add}\n      style={{\n        width: dimension.width,\n        height: dimension.height,\n        display: 'inline-block'\n      }}\n      id={key}\n      href={addInfo && addInfo.url}\n      target='_blank'\n      rel='noreferrer'\n      onClick={onAddClicked}\n      data-test-id=\"add-block\"\n    >\n      {imageLoaded && <span data-test-id=\"add-block-placeholder\" className={styles.add_label}>Ad</span>}\n      {!imageLoaded ? (\n        <img\n         data-test-id=\"add-block-dummy-image\"\n         decoding=\"async\"\n          src={`https://via.placeholder.com/${dimension.width}x${dimension.height}.png?text=AD`}\n        />\n      ) : null}\n      {addInfo && (\n        <img\n          decoding=\"async\"\n          onLoad={() => setImageLoaded(true)}\n          className={styles.add_img}\n          src={addInfo.img}\n          alt={addInfo.title}\n          style={{ visibility: imageLoaded ? 'visible' : 'hidden' }}\n          data-test-id=\"add-block-img\"\n        />\n      )}\n    </a>\n  )\n}\n\nexport default Add\n","export default (state: any, action: any) => {\n  const { type, payload } = action\n\n  switch (type) {\n    case 'GET_ADVERTISER_REQUEST':\n      return {\n        ...state,\n        addSlots: [...state.addSlots, payload]\n      }\n    case 'SET_ADVERTISERS':\n      return {\n        ...state,\n        advertisers: [...state.advertisers, ...action.payload],\n        addSlots: []\n      }\n    default:\n      return state\n  }\n}\n","import React, { useEffect, useReducer } from 'react'\nimport AppReducer from './AddReducer'\nimport AppContext from './addContext'\nimport { getAdvertisers, recordConversions } from '../api'\nimport { AdvertiserAddMapping } from '../types'\n\ntype addProviderProps = {\n  clientId: string\n}\n\nconst initialState = {\n  advertisers: [],\n  addSlots: []\n}\nconst AddProvider: React.FC<addProviderProps> = ({ clientId, children }) => {\n  const [state, dispatch] = useReducer(AppReducer, initialState)\n  const { advertisers, addSlots } = state\n  const registerAdd = (key: string) => {\n    dispatch({\n      type: 'GET_ADVERTISER_REQUEST',\n      payload: key\n    })\n  }\n\n  const addConversion = async (uid: string) => {\n    try {\n      await recordConversions(uid,clientId)\n    } catch (err) {\n      console.log(err)\n    }\n  }\n  const fetchAdvisers = async (addSlots: string[]) => {\n    try {\n      const availableAdvertisers: string [] = await getAdvertisers(\n        addSlots.length,\n        advertisers,\n        clientId\n      )\n      const advertisersMapToAdd : AdvertiserAddMapping [] = \n      availableAdvertisers.map((a, index) => {\n        return {\n          advertiser: a,\n          addKey: addSlots[index]\n        }\n      })\n      dispatch({\n        type: 'SET_ADVERTISERS',\n        payload: advertisersMapToAdd\n      })\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  useEffect(() => {\n    if (!clientId) {\n      console.error('clientId is required.')\n    }\n  },[])\n\n  useEffect(() => {\n    if (clientId && addSlots.length > 0) {\n      fetchAdvisers(addSlots)\n    }\n  }, [addSlots,clientId])\n  return (\n    <div>\n      <AppContext.Provider\n        value={{\n          advertisers: advertisers,\n          registerAdd: registerAdd,\n          addConversion: addConversion\n        }}\n      >\n        {children}\n      </AppContext.Provider>\n    </div>\n  )\n}\nexport default AddProvider\n","import React from 'react'\n\nimport { Add } from 'add-bidder'\n\nconst Content = () => {\n  //const [loadAdd ,setLoadAdd] = useState(false)\n\n  // setTimeout(() => {\n  //   console.log('fetch new add')\n  //   setLoadAdd(true)\n  // },2000)\n  return (\n    <main>\n      <header>\n        <h1>Add Bidder Demo </h1> \n      </header>\n      <Add size=\"banner\" />\n      <div className=\"articles\"> \n      <article className=\"card\">\n        <h3>Lorem ipsum </h3>\n        <p>\n        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin interdum nunc quam, et tincidunt nunc lobortis at. Vivamus vestibulum sagittis dapibus. Integer in ante tortor. Aliquam nec dolor neque. In magna massa, ultricies et risus a, efficitur consequat magna. Nunc varius lorem nisi. Aliquam fermentum maximus cursus. Integer eget nisl vitae magna vehicula ultricies. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Morbi malesuada in sapien sed commodo. Pellentesque vitae ornare magna. Aenean at nulla vitae mauris sollicitudin faucibus. Vivamus feugiat leo eget neque vestibulum, in elementum mi congue.\n        Suspendisse pharetra, diam et vestibulum rhoncus, velit magna feugiat arcu, at cursus risus urna sed libero. Sed gravida, nulla in molestie auctor, nulla ex vulputate est, id viverra ligula ipsum quis felis. Curabitur purus erat, faucibus ut odio id, consectetur eleifend risus. Etiam nec turpis sed urna aliquet blandit. Ut in volutpat enim. Nunc tincidunt ex nulla, quis bibendum nibh ullamcorper in. Ut aliquam bibendum odio, vel interdum justo ullamcorper vel. Nulla eu cursus felis. Sed eget enim id lectus mattis eleifend nec vitae nisi. Sed metus urna, eleifend id scelerisque dictum, commodo a purus. Integer eget consequat nisl. Proin id ipsum luctus, sollicitudin risus nec, vulputate ipsum.\n        Nulla in dui sit amet lectus pulvinar fringilla id sed elit. Quisque quis dolor dignissim, mattis odio quis, porttitor velit. Etiam sodales purus vitae elit suscipit, ut laoreet nisl blandit. Nunc sem leo, dictum ut dignissim ac, feugiat et ex. Sed in tincidunt turpis. Sed fermentum dui vel tellus semper, vel porttitor neque aliquam. Nulla aliquam rhoncus justo. Sed nulla purus, consectetur vitae erat eget, pharetra ullamcorper risus. Suspendisse ac ligula non lectus fermentum dignissim. Duis congue erat ac est blandit tempor. Donec fringilla nisi finibus, vulputate ligula quis, sollicitudin eros. Duis vitae aliquam nisi. Quisque congue rhoncus dui, ut auctor lacus mollis vitae. Proin tempor mollis quam, interdum lobortis tellus pulvinar non. Suspendisse varius sollicitudin sodales.\n        Nullam commodo magna at dolor euismod, id euismod enim laoreet. Nullam ac ipsum in mi fermentum bibendum non sit amet felis. Cras vehicula felis tortor, convallis condimentum est varius vel. Etiam non odio ultrices, fringilla ligula nec, cursus metus. Pellentesque nisl felis, venenatis eget iaculis nec, sagittis vitae odio. Nullam luctus facilisis dictum. Sed elementum quis libero at viverra. Etiam ex dolor, blandit quis venenatis eu, aliquet sit amet erat. Morbi nec sapien in dui fermentum hendrerit. Maecenas felis eros, sollicitudin quis eleifend et, feugiat id enim.\n        </p>\n      </article>\n      <Add size=\"banner\" />\n      <article className=\"card\">\n        <h3>Lorem ipsum </h3>\n        <p>\n        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin interdum nunc quam, et tincidunt nunc lobortis at. Vivamus vestibulum sagittis dapibus. Integer in ante tortor. Aliquam nec dolor neque. In magna massa, ultricies et risus a, efficitur consequat magna. Nunc varius lorem nisi. Aliquam fermentum maximus cursus. Integer eget nisl vitae magna vehicula ultricies. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Morbi malesuada in sapien sed commodo. Pellentesque vitae ornare magna. Aenean at nulla vitae mauris sollicitudin faucibus. Vivamus feugiat leo eget neque vestibulum, in elementum mi congue.\n        Suspendisse pharetra, diam et vestibulum rhoncus, velit magna feugiat arcu, at cursus risus urna sed libero. Sed gravida, nulla in molestie auctor, nulla ex vulputate est, id viverra ligula ipsum quis felis. Curabitur purus erat, faucibus ut odio id, consectetur eleifend risus. Etiam nec turpis sed urna aliquet blandit. Ut in volutpat enim. Nunc tincidunt ex nulla, quis bibendum nibh ullamcorper in. Ut aliquam bibendum odio, vel interdum justo ullamcorper vel. Nulla eu cursus felis. Sed eget enim id lectus mattis eleifend nec vitae nisi. Sed metus urna, eleifend id scelerisque dictum, commodo a purus. Integer eget consequat nisl. Proin id ipsum luctus, sollicitudin risus nec, vulputate ipsum.\n        Nulla in dui sit amet lectus pulvinar fringilla id sed elit. Quisque quis dolor dignissim, mattis odio quis, porttitor velit. Etiam sodales purus vitae elit suscipit, ut laoreet nisl blandit. Nunc sem leo, dictum ut dignissim ac, feugiat et ex. Sed in tincidunt turpis. Sed fermentum dui vel tellus semper, vel porttitor neque aliquam. Nulla aliquam rhoncus justo. Sed nulla purus, consectetur vitae erat eget, pharetra ullamcorper risus. Suspendisse ac ligula non lectus fermentum dignissim. Duis congue erat ac est blandit tempor. Donec fringilla nisi finibus, vulputate ligula quis, sollicitudin eros. Duis vitae aliquam nisi. Quisque congue rhoncus dui, ut auctor lacus mollis vitae. Proin tempor mollis quam, interdum lobortis tellus pulvinar non. Suspendisse varius sollicitudin sodales.\n        Nullam commodo magna at dolor euismod, id euismod enim laoreet. Nullam ac ipsum in mi fermentum bibendum non sit amet felis. Cras vehicula felis tortor, convallis condimentum est varius vel. Etiam non odio ultrices, fringilla ligula nec, cursus metus. Pellentesque nisl felis, venenatis eget iaculis nec, sagittis vitae odio. Nullam luctus facilisis dictum. Sed elementum quis libero at viverra. Etiam ex dolor, blandit quis venenatis eu, aliquet sit amet erat. Morbi nec sapien in dui fermentum hendrerit. Maecenas felis eros, sollicitudin quis eleifend et, feugiat id enim.\n        </p>\n      </article>\n      </div>\n    \n       {/* {loadAdd && <section className=\"right-bottom-add\">\n       <Add size=\"banner\" />\n       </section>} */}\n    </main>\n  )\n \n}\n\nexport default Content\n","import React from 'react'\nimport 'add-bidder/dist/index.css'\nimport Content from './Content'\nimport { AddProvider } from 'add-bidder';\n\nconst App = () => {\n  return (\n    <AddProvider clientId=\"client-233434\">\n      <Content/>\n    </AddProvider>\n  )\n \n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}